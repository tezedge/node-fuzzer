
# Build instructions
```
cargo build --release --bin new-node
```

# How to use
It is recommended to run the nodes inside a docker container limiting the amount of memory (for example passing `-m="8g"`).
The fuzzer sets the max number of connections to 1 to avoid connecting to anyone that is not the target, it is recommended to set the same limit for the target node (`--peer-thresh-high=1`). Ideally on should run it in an isolated network.

1. Run the target node, for example:
```
./run.sh release --network=mainnet --disable-bootstrap-lookup --synchronization-thresh 0 --peer-thresh-low=0 --peer-thresh-high=1
```
2. Once the target node is listening for connections run the fuzzer:
```
./target/release/new-node
```
By default the fuzzer will connect to peer `127.0.0.1:9732`. Peer address can be changed with the `-p` option.

Contents are generated by a `SmallRng` (PRNG) seeded by default with the `u64` value `123456789abcdef0`. This seed value can be changed with the `-s` option. 

By default all message types will be sent during fuzzing. A specific list of messages can be chosen with the `-m` option. Possible values are:
```
Advertise, SwapRequest, SwapAck, GetCurrentBranch,
CurrentBranch, Deactivate, GetCurrentHead, CurrentHead,
GetBlockHeaders, BlockHeader, GetOperations, Operation,
GetProtocols, Protocol, GetOperationsForBlocks, OperationsForBlocks
```

Example to fuzz only `Advertise` and `CurrentBranch` messages with seed `aabbccddaabbccdd`:
```
./target/release/new-node -m Advertise CurrentBranch -s aabbccddaabbccdd
```




